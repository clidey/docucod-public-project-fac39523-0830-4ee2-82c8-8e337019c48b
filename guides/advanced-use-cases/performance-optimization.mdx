---
title: "Configuration & Performance Optimization"
description: "Discover how to fine-tune the PostHog Go client using configuration options, personal API keys, batching, and endpoint selection for low-latency, high-volume environments."
---

# Configuration & Performance Optimization

Optimize your PostHog Go client to efficiently handle analytics and feature flags in demanding backend environments. This guide empowers you to fine-tune configurations including API key management, batching of events, endpoint selection, and other client behaviors designed to reduce latency and scale high volumes of traffic.

---

## Workflow Overview

- **Task Description:** Learn how to customize and enhance the PostHog Go client’s performance and configuration for low latency and high throughput.
- **Prerequisites:** A working Go environment with the PostHog Go client installed and basic integration completed. Access to your PostHog project API keys.
- **Expected Outcome:** You will configure the client for optimal performance through batching, endpoint selection, and secure API key usage to support production workloads.
- **Time Estimate:** 15–30 minutes
- **Difficulty Level:** Intermediate

---

## Step-by-Step Configuration & Optimization Guide

### 1. Setup Personal API Keys Securely

Ensure your client uses a **personal API key** for enhanced security and scoped permissions:

1. Obtain your personal API key from the PostHog dashboard under project settings.
2. Configure the client initialization with the key:

```go
import "github.com/PostHog/posthog-go"

client, err := posthog.NewWithConfig("personal_api_key", posthog.Config{
    Endpoint: "https://app.posthog.com", // Or your self-hosted endpoint
    FlushAt:  20, // Number of events collected before sending
})
if err != nil {
    log.Fatalf("Failed to initialize PostHog client: %v", err)
}
```

- The personal API key ensures your backend has the necessary permissions without exposing project-level keys.

### 2. Configure Event Batching

Batching reduces network overhead and increases throughput:

- **FlushAt:** Number of queued events before sending batch.
- **FlushInterval:** Maximum time duration before flushing.

Example configuration:

```go
client, err := posthog.NewWithConfig("personal_api_key", posthog.Config{
    FlushAt:       50,             // Send after 50 events
    FlushInterval: time.Second * 5, // Or after 5 seconds
})
```

**Result:** Higher `FlushAt` reduces network requests but increases latency in event reporting. Adjust based on application sensitivity.

### 3. Select Optimal Endpoint

- Use the official PostHog Cloud endpoint (`https://app.posthog.com`) or your self-hosted instance's URL.
- Ensure the `Endpoint` matches your deployment and supports the `/i/v0/e/` ingestion API.

```go
client, err := posthog.NewWithConfig("key", posthog.Config{
    Endpoint: "https://your-posthog-instance.com",
})
```

### 4. Enable Compression for Payloads

The client supports various compression methods (`gzip`, `gzip-js`, and `lz64`) to reduce payload size.

- Compression is automatically negotiated; no extra setup is required, but verify your server supports these methods.

### 5. Fine-Tune Additional Options

- **Enable Collect Everything:** If enabled, the client collects all events automatically.
- **Autocapture Opt-out:** Control whether autocapture events should be sent.

Example:

```go
client, err := posthog.NewWithConfig("key", posthog.Config{
    EnableCollectEverything: true,
    AutocaptureOptOut:       false,
})
```

### 6. Performance Best Practices

- Avoid setting extremely low `FlushAt` (e.g., 1) to prevent performance bottlenecks.
- Balance flush interval and batch size for your application’s event volume.
- Monitor client errors and buffer usage to preemptively address dropped events.

---

## Code Sample: Complete Client Configuration Example

```go
package main

import (
    "log"
    "time"

    "github.com/PostHog/posthog-go"
)

func main() {
    client, err := posthog.NewWithConfig("your_personal_api_key", posthog.Config{
        Endpoint:              "https://app.posthog.com",
        FlushAt:               100,              // Batch size before sending
        FlushInterval:         3 * time.Second,  // Max wait before sending batch
        EnableCollectEverything: true,            // Collect all events automatically
        AutocaptureOptOut:     false,             // Enable autocapture
    })

    if err != nil {
        log.Fatalf("Failed to create PostHog client: %v", err)
    }

    // Example event capture
    client.Capture(&posthog.Capture{
        DistinctId: "user123",
        Event:      "app_started",
    })

    // Flush before exit
    client.Close()
}
```

---

## Troubleshooting & Optimization Tips

<AccordionGroup title="Common Issues and Solutions">
<Accordion title="Events Not Showing Up in Dashboard">
- Confirm API key and endpoint correctness.
- Increase logging verbosity to debug client behavior.
- Check for network errors or dropped packets.
</Accordion>
<Accordion title="High Latency in Event Processing">
- Increase `FlushAt` and `FlushInterval` for batching.
- Profile your backend to ensure network and CPU resources are sufficient.
</Accordion>
<Accordion title="Excessive Memory Usage or Buffer Growth">
- Monitor event queue size.
- Tune flush parameters to avoid large queues.
- Ensure the application calls `Close()` on client shutdown to flush pending events.
</Accordion>
</AccordionGroup>

<Tip>
Always use your personal API key and never expose project API keys in client-side or untrusted environments.
</Tip>

---

## Performance Optimization Summary

| Configuration Parameter      | Effect                             | Recommended Setting              |
|------------------------------|----------------------------------|--------------------------------|
| `FlushAt`                   | Batch size before sending events | 20-100 depending on traffic      |
| `FlushInterval`             | Max wait time before flush        | 2-5 seconds                     |
| `EnableCollectEverything`   | Auto-capture all events           | Enable for general tracking      |
| Endpoint                   | Analytics ingestion endpoint       | Match your environment           |

---

## Next Steps & Related Content

- Explore [Integration with the PostHog Platform](/overview/features-and-integration/integration-with-posthog) for setup details.
- Review [Core Features at a Glance](/overview/features-and-integration/feature-highlights) to leverage feature flags.
- Read the [Client Initialization & Authentication](/api-reference/core-entities/client-initialization-auth) page for in-depth auth options.
- Start capturing meaningful events with the [Capturing Events](/guides/core-workflows/capturing-events) guide.

---

For further customization and advanced client options, consult the [Configuration & Advanced Client Options](/api-reference/advanced-usage-errors/configuration-options) API reference.


---

## Visualizing Configuration Flow

```mermaid
flowchart TD
    A[Start] --> B[Load Personal API Key]
    B --> C[Initialize PostHog Client with Config]
    C --> D{Configure Batching Parameters}
    D -->|FlushAt set| E[Set Batch Size]
    D -->|FlushInterval set| F[Set Flush Timeout]
    E & F --> G[Enable Compression Transport]
    G --> H[Select Endpoint URL]
    H --> I[Capture Events & Feature Flags]
    I --> J{Flush Triggered?}
    J -->|Yes| K[Send Batched Events]
    J -->|No| I
    K --> I
    I --> L[Application Shutdown]
    L --> M[Call Close() to Flush Remaining Events]
    M --> N[Cleanup & Exit]
```

---